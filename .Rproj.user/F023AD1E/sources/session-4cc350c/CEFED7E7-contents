---
title: "Results (draft 1)"
format: html
editor: visual
---

```{r, echo = FALSE, include = FALSE}
source(here::here("00_helpers.R"))
library(ggsignif)
library(tidyverse)
library(here)

mv_long = read.csv(here("data", "tidy", "mv_long.csv"))
dz_long = read.csv(here("data", "tidy", "dz_long.csv")) 

stim_df = read.csv(here("data", "tidy", "stim_df.csv"))
stim_df_bfd = read.csv(here("data", "tidy", "stim_df_bfd.csv"))

long_all = rbind(mv_long, dz_long)

model_df = long_all %>% 
  group_by(tones, DEPT, sentence_type) %>% 
  summarize(n = n()) %>% 
  pivot_wider(names_from = DEPT, values_from = n) %>% 
  filter(Montevideo > 5 | Durazno > 5) %>% 
  pivot_longer(cols = 3:4, names_to = "City", values_to = "count") %>% 
  mutate(tones = replace_na(tones, "N/A")) %>% 
  mutate(total_speakers = case_when(
    City == "Montevideo" ~ 30,
    City == "Durazno" ~ 20
  ))

long_all$tones = gsub("L*L%"  , "L* L%" , long_all$tones , fixed = TRUE)

```
<!--- 1 hour, start 12:22 finish 3- 3.5 hrs total--->

```{r, include=FALSE}
knitr::opts_chunk$set(
  comment = "#>", echo = FALSE, fig.width = 6, warning = FALSE, error = FALSE, message = FALSE
)
```

> What Pitch Accents tend to mark focus?**

*Broad Focus Declaratives*  

Full list, unchanged:

```{r}
long_all %>% 
  filter(position == "N") %>% 
  filter(sentence_type == "BFD") %>% 
  group_by(tones, DEPT) %>% 
  summarize(n = n()) %>% 
  pivot_wider(names_from = DEPT, values_from = n) %>% 
  mutate(Montevideo = round(replace_na(Montevideo, 0)/90, digits = 2)*100) %>% 
  mutate(Durazno = round(replace_na(Durazno, 0)/60, digits = 2)*100) %>% 
  knitr::kable(format = "pandoc", caption = "Total percentage of each pitch accent in nuclear position for Broad Focus Decaratives.")
```

Full list, at least 5 total occurrences:

```{r}
long_all %>% 
  filter(position == "N") %>% 
  filter(sentence_type == "BFD") %>% 
  group_by(tones, DEPT) %>% 
  summarize(n = n()) %>% 
  pivot_wider(names_from = DEPT, values_from = n) %>% 
  mutate(Montevideo = round(replace_na(Montevideo, 0)/90, digits = 2)*100) %>% 
  mutate(Durazno = round(replace_na(Durazno, 0)/60, digits = 2)*100) %>% 
  filter(Montevideo > 5 | Durazno > 5) %>% 
  knitr::kable(format = "pandoc", caption = "Total percentage of each pitch accent in nuclear position in which one group had produced it atleast 5 percent of the time in the data for Broad Focus Decaratives.")
```

*Plot of Table 2*
```{r}
make_sig_plot("N", "BFD", long_all)
```


> In BFD we could mostly ignore boundary tones (e.g., L- and L%)"

We can integrate these if you prefer, but there does not look like there would be a major shift in the trend. 

*Narrow Focus Declaratives*

Full list, unchanged:

```{r}
long_all %>% 
  filter(position == "N1") %>% 
  filter(sentence_type == "NFD") %>% 
  group_by(tones, DEPT) %>% 
  summarize(n = n()) %>% 
  pivot_wider(names_from = DEPT, values_from = n) %>% 
  mutate(Montevideo = round(replace_na(Montevideo, 0)/180, digits = 2)*100) %>% 
  mutate(Durazno = round(replace_na(Durazno, 0)/120, digits = 2)*100) %>% 
  knitr::kable(format = "pandoc", caption = "Total percentage of each pitch accent in nuclear position for Narrow Focus Decaratives.")
```

Full list, at least 5 total occurrences:

```{r}
long_all %>% 
  filter(position == "N1") %>% 
  filter(sentence_type == "NFD") %>% 
  group_by(tones, DEPT) %>% 
  summarize(n = n()) %>% 
  pivot_wider(names_from = DEPT, values_from = n) %>% 
  mutate(Montevideo = round(replace_na(Montevideo, 0)/180, digits = 2)*100) %>% 
  mutate(Durazno = round(replace_na(Durazno, 0)/120, digits = 2)*100) %>% 
  filter(Montevideo > 5 | Durazno > 5) %>% 
  knitr::kable(format = "pandoc", caption = "Total percentage of each pitch accent in nuclear position in which one group had produced it atleast 5 percent of the time in the data for Narrow Focus Decaratives.")
```

*Plot of Table 4*
```{r}
make_sig_plot("N1","NFD", long_all)
```


> In the NFD it becomes clear that the !H% IP boundary tone is a clear difference between DZ (which has it) and MV (that mostly doesnt)."

There is a significant difference here (p < .005).

> At the same time we see that the tritonal L+H*+L is more common in MV than DZ.

This is descriptively true (the count for MV is higher), but the poisson regression was not significant in this case (p > .05). This does not mean the difference is not real, but more likely that there just isn't enough data for the model to return a significant effect.

> L*+H is more common in DZ than MV. 

I don't actually see this in the data.

> What seems clear in both DZ and MV is that upstepping (¡) is a big part of marking focus, thus in an utterance full of L+H*, focus is rightly marked with L+¡H*, in cases such as NFD5 Con Manuel, these are all high peaks but due to the lack of an earlier comparative peak they are not classified as upstepped. 

Here's a plot showing both cities productions for NFD5. It looks like the two groups are a little different than you've described above: Durazno speakers prefer L+H* !H%.
The Montevideo group, on the other hand, produce L+H*+L L% the most.

```{r}
long_all %>% 
  filter(sentence == "NFD5") %>% 
  group_by(tones, DEPT) %>% 
  summarize(n = n()) %>% 
  pivot_wider(names_from = DEPT, values_from = n) %>% 
  mutate(Montevideo = round(replace_na(Montevideo, 0)/30, digits = 2)*100) %>% 
  mutate(Durazno = round(replace_na(Durazno, 0)/20, digits = 2)*100) %>% 
  knitr::kable(format = "pandoc", caption = "Total percentage of each pitch accent in NFD5 'con Manuel'")
```

```{r}
long_all %>% 
  filter(sentence == "NFD5") %>% 
  group_by(tones, DEPT) %>% 
  summarize(n = n()) %>% 
  pivot_wider(names_from = DEPT, values_from = n) %>% 
  mutate(Montevideo = round(replace_na(Montevideo, 0)/30, digits = 2)*100) %>% 
  mutate(Durazno = round(replace_na(Durazno, 0)/20, digits = 2)*100) %>% 
  filter(Montevideo > 5 | Durazno > 5) %>% 
  knitr::kable(format = "pandoc", caption = "Total percentage of each pitch accent in NFD5 'con Manuel' occuring at least 5 total times")
```

```{r}
make_sig_plot("N1","NFD", long_all %>% 
                filter(sentence == "NFD5"))  
```

> Thus if in the count for focalized items L+H* rather than L+¡H* it should be undestood that these are, in such a case not different and can be grouped, whereas in sentences with PN peaks these are different. 

Let me know about specific groupings (a list would be ideal), and I can systematically integrate them in the analysis pipeline, which will spit out new plots etc. just by being run again after necessary adjustments. 

> Socially, (at least before the current updated data) women tended to use the tritonal L+H*+L as well as the upstep ¡ more than men, this again is a key distinction as it once again provided evidence for the theory of females making greater contrasts and therfore greater clarity in speaking. 

```{r}
make_sig_plot_gender("N1", "NFD", long_all)
```


```{r}
make_sig_plot_gender("N", "BFD", long_all)
```


> Also if you find that certain utterance tend to prefer unique forms, such as NFD5 "a statement of the obvious" where tritonals may be more common or where the mid-boundary tone !H% is more frequent this is also of note. 

```{r}
stim_df %>% 
  select(-X) %>% 
  knitr::kable(format = "pandoc")

```

```{r}
stim_df %>% 
   ggplot(aes(x = tones, y = Percentage, fill = DEPT, position = "dodge")) + 
  geom_col(color = "black", position = "dodge2") + theme_minimal() +
  facet_wrap(~Sentence) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```


```{r}
stim_df_bfd %>% 
  select(-X) %>% 
  knitr::kable(format = "pandoc")

```


```{r}
stim_df_bfd %>% 
   ggplot(aes(x = tones, y = Percentage, fill = DEPT, position = "dodge")) + 
  geom_col(color = "black", position = "dodge2") + theme_minimal() +
  facet_wrap(~Sentence) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```
