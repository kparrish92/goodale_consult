thisdf$Age.Group = relevel(thisdf$Age.Group, ref = "x36_59")
if (thisdf[2,3] == 0){
poisson_model_city = "No test"
} else {
poisson_model_city = glm(n ~ Age.Group, data = thisdf, family = poisson(link = "log"))
}
results[thistone, 1] = tone_types[thistone]
results[thistone, 2] = "unfocued pn"
results[thistone, 3] = ifelse(typeof(poisson_model_city) == "list",
ifelse(summary(poisson_model_city)[["coefficients"]][2,4] < .05, print("*"), "NS"),
"NT")
results[thistone, 4] = ifelse(typeof(poisson_model_city) == "list",
ifelse(summary(poisson_model_city)[["coefficients"]][3,4] < .05, print("*"), "NS"),
"NT")
}
res_df = results %>%
as.data.frame() %>%
rename(tones = V1,
statement_type = V2,
p_value_sec = V3,
p_value_ter = V4)
ypost_c1 = plotdf %>%
# filter(EDU.Simplified == "Primary/Middle" | EDU.Simplified == "Secondary") %>%
group_by(tones) %>%
summarize(yp = sum(n)) %>%
mutate(tones = replace_na(tones, "N/A"))
pdf = left_join(res_df, ypost_c1, by = "tones")
plotdf$tones = factor(plotdf$tones, levels = c(res_df$tones))
plot = plotdf %>%
mutate(tones = replace_na(tones, "N/A")) %>%
ggplot(aes(x = tones, y = n, fill = Age.Group)) +
geom_col(color = "black") +
geom_signif(y_position = c(pdf$yp+1), xmin = c(create_xminp_c1(nrow(pdf))),
xmax = c(create_xmaxp_c1(nrow(pdf))), annotation = c(pdf$p_value_sec),
tip_length = 0)  +
geom_signif(y_position = c(pdf$yp+2), xmin = c(create_xminp_c2(nrow(pdf))),
xmax = c(create_xmaxp_c2(nrow(pdf))), annotation = c(pdf$p_value_ter),
tip_length = 0)
return(plot)
}
plot_Gender_no = function(city)
{
plotdf = long_all %>%
mutate(tones = str_remove(tones, " L-")) %>%
#  mutate(tones = str_trim(str_replace(tones, "L%", ""))) %>%
filter(DEPT == city) %>%
filter(words == "No") %>%
filter(sentence == "NFD3") %>%
group_by(Gender, tones) %>%
summarize(n = n()) %>%
pivot_wider(names_from = Gender, values_from = n) %>%
mutate(Female = replace_na(Female, 0)) %>%
mutate(Male = replace_na(Male, 0)) %>%
# filter(Male > 3 | Female > 3) %>%
pivot_longer(cols = 2:3, names_to = "Gender", values_to = "n") %>%
mutate(tones = replace_na(tones, "N/A"))
tone_types = unique(plotdf$tones)
results = matrix(ncol = 3, nrow = length(tone_types))
# Run BFD models and store p_values
for (thistone in 1:length(tone_types)) {
thisdf = plotdf %>% filter(tones == tone_types[thistone])
poisson_model_city <- glm(n ~ Gender, data =
thisdf,
family = poisson(link = "log"))
results[thistone, 1] = tone_types[thistone]
results[thistone, 2] = "NFD"
results[thistone, 3] = summary(poisson_model_city)[["coefficients"]][2,4]
}
res_df = results %>%
as.data.frame() %>%
rename(tones = V1,
statement_type = V2,
p_value = V3) %>%
mutate(p_value = as.numeric(p_value)) %>%
mutate(result = case_when(
p_value > .05 ~ "NS",
p_value < .05 & p_value > .005 ~ "*",
p_value < .005 & p_value > .0005 ~ "**",
p_value < .0005 ~ "***"
))
# get y positions
ypost = plotdf %>%
group_by(tones) %>%
summarize(yp = sum(n)) %>%
mutate(tones = replace_na(tones, "N/A"))
pdf = left_join(res_df, ypost, by = "tones")
#pdf = left_join(res_df, ypost_c1, by = "tones")
plotdf$tones = factor(plotdf$tones, levels = c(res_df$tones))
plot = plotdf %>%
mutate(tones = replace_na(tones, "N/A")) %>%
ggplot(aes(x = tones, y = n, fill = Gender)) +
geom_col(color = "black") +
geom_signif(y_position = c(pdf$yp+1), xmin = c(create_xminp(nrow(pdf))),
xmax = c(create_xmaxp(nrow(pdf))), annotation = c(pdf$result),
tip_length = 0)
return(plot)
}
Gender_p_table = function(city, sent)
{
df_p7 = long_all %>%
#    mutate(tones = str_remove(tones, " L-")) %>%
filter(DEPT == city & focused == 1 & sentence == sent) %>%
group_by(tones) %>%
summarize(n = n()) %>%
filter(n > 1)
plotdf = long_all %>%
filter(DEPT == city & focused == 1 & sentence == sent) %>%
#mutate(tones = str_remove(tones, " L-")) %>%
#  mutate(tones = str_trim(str_replace(tones, "L%", ""))) %>%
group_by(Gender, tones) %>%
summarize(n = n()) %>%
filter(tones %in% df_p7$tones) %>%
pivot_wider(names_from = Gender, values_from = n) %>%
mutate(Female = replace_na(Female, 0)) %>%
mutate(Male = replace_na(Male, 0)) %>%
# filter(Male > 3 | Female > 3) %>%
pivot_longer(cols = 2:3, names_to = "Gender", values_to = "n") %>%
mutate(tones = replace_na(tones, "N/A"))
tone_types = unique(plotdf$tones)
results = matrix(ncol = 2, nrow = length(tone_types))
# Run BFD models and store p_values
for (thistone in 1:length(tone_types)) {
thisdf = plotdf %>% filter(tones == tone_types[thistone])
poisson_model_city <- glm(n ~ Gender, data =
thisdf,
family = poisson(link = "log"))
results[thistone, 1] = tone_types[thistone]
results[thistone, 2] = summary(poisson_model_city)[["coefficients"]][2,4]
}
res_df = results %>%
as.data.frame() %>%
rename(tones = V1,
p_value = V2) %>%
mutate(p_value = as.numeric(p_value)) %>%
mutate(result = case_when(
p_value > .05 ~ "NS",
p_value < .05 & p_value > .005 ~ "*",
p_value < .005 & p_value > .0005 ~ "**",
p_value < .0005 ~ "***"
))
return(res_df)
}
age_p_table = function(city, sent)
{
df_p7 = long_all %>%
#    mutate(tones = str_remove(tones, " L-")) %>%
filter(DEPT == city & focused == 1 & sentence == sent) %>%
group_by(tones) %>%
summarize(n = n()) %>%
filter(n > 1)
plotdf = long_all %>%
filter(DEPT == city & focused == 1 & sentence == sent) %>%
#  mutate(tones = str_trim(str_replace(tones, "L%", ""))) %>%
group_by(Age.Group, tones) %>%
summarize(n = n()) %>%
filter(tones %in% df_p7$tones) %>%
pivot_wider(names_from = Age.Group, values_from = n) %>%
janitor::clean_names() %>%
mutate(x18_35 = replace_na(x18_35, 0)) %>%
mutate(x36_59 = replace_na(x36_59, 0)) %>%
mutate(x60 = replace_na(x60, 0)) %>%
#    filter(x18_35 > 1 | x36_59 > 1 | x60 > 1) %>%
pivot_longer(cols = 2:4, names_to = "Age.Group", values_to = "n") %>%
mutate(tones = replace_na(tones, "N/A"))
tone_types = unique(plotdf$tones)
results = matrix(ncol = 3, nrow = length(tone_types))
for (thistone in 1:length(tone_types)) {
thisdf = plotdf %>% filter(tones == tone_types[thistone])
thisdf$Age.Group = as.factor(thisdf$Age.Group)
thisdf$Age.Group = relevel(thisdf$Age.Group, ref = "x36_59")
if (thisdf[2,3] == 0){
poisson_model_city = "No test"
} else {
poisson_model_city = glm(n ~ Age.Group, data = thisdf, family = poisson(link = "log"))
}
results[thistone, 1] = tone_types[thistone]
results[thistone, 2] = ifelse(typeof(poisson_model_city) == "list",
ifelse(summary(poisson_model_city)[["coefficients"]][2,4] < .05, print("*"), "NS"),
"NT")
results[thistone, 3] = ifelse(typeof(poisson_model_city) == "list",
ifelse(summary(poisson_model_city)[["coefficients"]][3,4] < .05, print("*"), "NS"),
"NT")}
res_df = results %>%
as.data.frame() %>%
rename(tones = V1,
p_value_18_35 = V2,
p_value_60 = V3)
return(res_df)
}
## Make 8 plot for "no" in NFD 3
no_plot_8 = function(city)
{
df_p7 = long_all %>%
#  rename(Gender = gender) %>%
mutate(tones = str_remove(tones, " L-")) %>%
#  mutate(tones = str_trim(str_replace(tones, "L%", ""))) %>%
filter(DEPT == city) %>%
filter(words == "No") %>%
filter(sentence == "NFD3") %>%
group_by(tones) %>%
summarize(n = n()) %>%
filter(n > 1)
a = df_p7 %>%
ggplot(aes(x = tones, y = n, position = "dodge")) +
geom_col(color = "black", position = "dodge2") + goodale_theme() +
scale_y_continuous(breaks=seq(1,max(df_p7$n),1))
b = long_all %>%
mutate(tones = str_remove(tones, " L-")) %>%
#   rename(Gender = gender) %>%
filter(DEPT == city) %>%
filter(words == "No") %>%
filter(sentence == "NFD3") %>%
group_by(tones, Gender) %>%
summarize(n = n()) %>%
filter(tones %in% df_p7$tones) %>%
ggplot(aes(x = tones, y = n, fill = Gender)) +
geom_col(color = "black") + goodale_theme() +
scale_y_continuous(breaks=seq(1,max(df_p7$n),1))
c = long_all %>%
mutate(tones = str_remove(tones, " L-")) %>%
filter(DEPT == city) %>%
filter(words == "No") %>%
filter(sentence == "NFD3") %>%
group_by(tones, Age.Group) %>%
summarize(n = n()) %>%
filter(tones %in% df_p7$tones) %>%
ggplot(aes(x = tones, y = n, fill = Age.Group)) +
geom_col(color = "black") + goodale_theme() +
scale_y_continuous(breaks=seq(1,max(df_p7$n),1))
library(patchwork)
combined <- a + b + c & theme(legend.position = "bottom")
plot = combined + plot_layout(guides = "collect")
return(plot)
}
age_p_table_no = function(city, sent)
{
df_p7 = long_all %>%
mutate(tones = str_remove(tones, " L-")) %>%
filter(DEPT == city) %>%
filter(words == "No") %>%
filter(sentence == "NFD3") %>%
group_by(tones) %>%
summarize(n = n()) %>%
filter(n > 1)
plotdf = long_all %>%
#  mutate(tones = str_trim(str_replace(tones, "L%", ""))) %>%
mutate(tones = str_remove(tones, " L-")) %>%
filter(DEPT == city) %>%
filter(words == "No") %>%
filter(sentence == "NFD3") %>%
group_by(Age.Group, tones) %>%
summarize(n = n()) %>%
filter(tones %in% df_p7$tones) %>%
pivot_wider(names_from = Age.Group, values_from = n) %>%
janitor::clean_names() %>%
mutate(x18_35 = replace_na(x18_35, 0)) %>%
mutate(x36_59 = replace_na(x36_59, 0)) %>%
mutate(x60 = replace_na(x60, 0)) %>%
#    filter(x18_35 > 1 | x36_59 > 1 | x60 > 1) %>%
pivot_longer(cols = 2:4, names_to = "Age.Group", values_to = "n") %>%
mutate(tones = replace_na(tones, "N/A"))
tone_types = unique(plotdf$tones)
results = matrix(ncol = 3, nrow = length(tone_types))
for (thistone in 1:length(tone_types)) {
thisdf = plotdf %>% filter(tones == tone_types[thistone])
thisdf$Age.Group = as.factor(thisdf$Age.Group)
thisdf$Age.Group = relevel(thisdf$Age.Group, ref = "x36_59")
if (thisdf[2,3] == 0){
poisson_model_city = "No test"
} else {
poisson_model_city = glm(n ~ Age.Group, data = thisdf, family = poisson(link = "log"))
}
results[thistone, 1] = tone_types[thistone]
results[thistone, 2] = ifelse(typeof(poisson_model_city) == "list",
ifelse(summary(poisson_model_city)[["coefficients"]][2,4] < .05, print("*"), "NS"),
"NT")
results[thistone, 3] = ifelse(typeof(poisson_model_city) == "list",
ifelse(summary(poisson_model_city)[["coefficients"]][3,4] < .05, print("*"), "NS"),
"NT")
}
res_df = results %>%
as.data.frame() %>%
rename(tones = V1,
p_value_18_35 = V2,
p_value_60 = V3)
return(res_df)
}
Gender_p_table_no = function(city, sent)
{
df_p7 = long_all %>%
filter(DEPT == city) %>%
filter(words == "No") %>%
filter(sentence == "NFD3") %>%
group_by(tones) %>%
summarize(n = n()) %>%
filter(n > 1)
plotdf = long_all %>%
mutate(tones = str_remove(tones, " L-")) %>%
#  mutate(tones = str_trim(str_replace(tones, "L%", ""))) %>%
filter(DEPT == city) %>%
filter(words == "No") %>%
filter(sentence == "NFD3") %>%
group_by(Gender, tones) %>%
summarize(n = n()) %>%
filter(tones %in% df_p7$tones) %>%
pivot_wider(names_from = Gender, values_from = n) %>%
mutate(Female = replace_na(Female, 0)) %>%
mutate(Male = replace_na(Male, 0)) %>%
# filter(Male > 3 | Female > 3) %>%
pivot_longer(cols = 2:3, names_to = "Gender", values_to = "n") %>%
mutate(tones = replace_na(tones, "N/A"))
tone_types = unique(plotdf$tones)
results = matrix(ncol = 2, nrow = length(tone_types))
# Run BFD models and store p_values
for (thistone in 1:length(tone_types)) {
thisdf = plotdf %>% filter(tones == tone_types[thistone])
poisson_model_city <- glm(n ~ Gender, data =
thisdf,
family = poisson(link = "log"))
results[thistone, 1] = tone_types[thistone]
results[thistone, 2] = summary(poisson_model_city)[["coefficients"]][2,4]
}
res_df = results %>%
as.data.frame() %>%
rename(tones = V1,
p_value = V2) %>%
mutate(p_value = as.numeric(p_value)) %>%
mutate(result = case_when(
p_value > .05 ~ "NS",
p_value < .05 & p_value > .005 ~ "*",
p_value < .005 & p_value > .0005 ~ "**",
p_value < .0005 ~ "***"
))
return(res_df)
}
Gender_p_table_no("Montevideo", "NFD3")
city = "Montevideo"
sent = "NFD3"
df_p7 = long_all %>%
filter(DEPT == city) %>%
filter(words == "No") %>%
filter(sentence == "NFD3") %>%
group_by(tones) %>%
summarize(n = n()) %>%
filter(n > 1)
df_p7
long_all %>%
#mutate(tones = str_remove(tones, " L-")) %>%
#  mutate(tones = str_trim(str_replace(tones, "L%", ""))) %>%
group_by(Gender, tones) %>%
summarize(n = n()) %>%
filter(tones %in% df_p7$tones)
long_all %>%
#mutate(tones = str_remove(tones, " L-")) %>%
#  mutate(tones = str_trim(str_replace(tones, "L%", ""))) %>%
group_by(Gender, tones) %>%
summarize(n = n()) %>%
filter(tones %in% df_p7$tones) %>%
pivot_wider(names_from = Gender, values_from = n) %>%
mutate(Female = replace_na(Female,
long_all %>%
#mutate(tones = str_remove(tones, " L-")) %>%
#  mutate(tones = str_trim(str_replace(tones, "L%", ""))) %>%
group_by(Gender, tones) %>%
summarize(n = n()) %>%
filter(tones %in% df_p7$tones) %>%
pivot_wider(names_from = Gender, values_from = n) %>%
mutate(Female = replace_na(Female, 0)) %>%
mutate(Male = replace_na(Male, 0)) %>%
# filter(Male > 3 | Female > 3) %>%
pivot_longer(cols = 2:3, names_to = "Gender", values_to = "n") %>%
mutate(tones = replace_na(tones, "N/A"))
ong_all %>%
df_p7 = long_all %>%
filter(DEPT == city) %>%
filter(words == "No") %>%
filter(sentence == "NFD3") %>%
group_by(tones) %>%
summarize(n = n()) %>%
filter(n > 1)
long_all %>%
#mutate(tones = str_remove(tones, " L-")) %>%
#  mutate(tones = str_trim(str_replace(tones, "L%", ""))) %>%
group_by(Gender, tones) %>%
summarize(n = n()) %>%
filter(tones %in% df_p7$tones) %>%
pivot_wider(names_from = Gender, values_from = n) %>%
mutate(Female = replace_na(Female, 0)) %>%
mutate(Male = replace_na(Male, 0)) %>%
# filter(Male > 3 | Female > 3) %>%
pivot_longer(cols = 2:3, names_to = "Gender", values_to = "n") %>%
mutate(tones = replace_na(tones, "N/A"))
plotdf = long_all %>%
#mutate(tones = str_remove(tones, " L-")) %>%
#  mutate(tones = str_trim(str_replace(tones, "L%", ""))) %>%
group_by(Gender, tones) %>%
summarize(n = n()) %>%
filter(tones %in% df_p7$tones) %>%
pivot_wider(names_from = Gender, values_from = n) %>%
mutate(Female = replace_na(Female, 0)) %>%
mutate(Male = replace_na(Male, 0)) %>%
# filter(Male > 3 | Female > 3) %>%
pivot_longer(cols = 2:3, names_to = "Gender", values_to = "n") %>%
mutate(tones = replace_na(tones, "N/A"))
plotdf
tone_types = unique(plotdf$tones)
results = matrix(ncol = 2, nrow = length(tone_types))
tone_types
plotdf
thistone = 1
thisdf = plotdf %>% filter(tones == tone_types[thistone])
poisson_model_city <- glm(n ~ Gender, data =
thisdf,
family = poisson(link = "log"))
poisson_model_city
Gender_p_table_no = function(city, sent)
{
df_p7 = long_all %>%
filter(DEPT == city) %>%
filter(words == "No") %>%
filter(sentence == "NFD3") %>%
group_by(tones) %>%
summarize(n = n()) %>%
filter(n > 1)
plotdf = long_all %>%
#mutate(tones = str_remove(tones, " L-")) %>%
#  mutate(tones = str_trim(str_replace(tones, "L%", ""))) %>%
group_by(Gender, tones) %>%
summarize(n = n()) %>%
filter(tones %in% df_p7$tones) %>%
pivot_wider(names_from = Gender, values_from = n) %>%
mutate(Female = replace_na(Female, 0)) %>%
mutate(Male = replace_na(Male, 0)) %>%
# filter(Male > 3 | Female > 3) %>%
pivot_longer(cols = 2:3, names_to = "Gender", values_to = "n") %>%
mutate(tones = replace_na(tones, "N/A"))
tone_types = unique(plotdf$tones)
results = matrix(ncol = 2, nrow = length(tone_types))
# Run BFD models and store p_values
for (thistone in 1:length(tone_types)) {
thisdf = plotdf %>% filter(tones == tone_types[thistone])
poisson_model_city <- glm(n ~ Gender, data =
thisdf,
family = poisson(link = "log"))
results[thistone, 1] = tone_types[thistone]
results[thistone, 2] = summary(poisson_model_city)[["coefficients"]][2,4]
}
res_df = results %>%
as.data.frame() %>%
rename(tones = V1,
p_value = V2) %>%
mutate(p_value = as.numeric(p_value)) %>%
mutate(result = case_when(
p_value > .05 ~ "NS",
p_value < .05 & p_value > .005 ~ "*",
p_value < .005 & p_value > .0005 ~ "**",
p_value < .0005 ~ "***"
))
return(res_df)
}
Gender_p_table_no(city, sent)
Gender_p_table_no("Montevideo", "NFD3")
Gender_p_table_no = function(city, sent)
{
df_p7 = long_all %>%
filter(DEPT == city) %>%
filter(words == "No") %>%
filter(sentence == "NFD3") %>%
group_by(tones) %>%
summarize(n = n()) %>%
filter(n > 1)
plotdf = long_all %>%
#mutate(tones = str_remove(tones, " L-")) %>%
#  mutate(tones = str_trim(str_replace(tones, "L%", ""))) %>%
group_by(Gender, tones) %>%
summarize(n = n()) %>%
filter(tones %in% df_p7$tones) %>%
pivot_wider(names_from = Gender, values_from = n) %>%
mutate(Female = replace_na(Female, 0)) %>%
mutate(Male = replace_na(Male, 0)) %>%
# filter(Male > 3 | Female > 3) %>%
pivot_longer(cols = 2:3, names_to = "Gender", values_to = "n") %>%
mutate(tones = replace_na(tones, "N/A"))
tone_types = unique(plotdf$tones)
results = matrix(ncol = 2, nrow = length(tone_types))
# Run BFD models and store p_values
for (thistone in 1:length(tone_types)) {
thisdf = plotdf %>% filter(tones == tone_types[thistone])
poisson_model_city <- glm(n ~ Gender, data =
thisdf,
family = poisson(link = "log"))
results[thistone, 1] = tone_types[thistone]
results[thistone, 2] = summary(poisson_model_city)[["coefficients"]][2,4]
}
res_df = results %>%
as.data.frame() %>%
rename(tones = V1,
p_value = V2) %>%
mutate(p_value = as.numeric(p_value)) %>%
mutate(result = case_when(
p_value > .05 ~ "NS",
p_value < .05 & p_value > .005 ~ "*",
p_value < .005 & p_value > .0005 ~ "**",
p_value < .0005 ~ "***"
))
return(res_df)
}
Gender_p_table_no("Montevideo", "NFD3") %>%
knitr::kable(format = "pandoc", align = c("l", "r", "r", "r", "r", "r"),
caption = "A summary of Gender poisson regressions for Montevideo NFD3 no")
sig_plot_for_combined("Durazno", "Gender") + goodale_theme() + theme_bw()
sig_plot_for_combined("Durazno", "Gender") + goodale_theme()
